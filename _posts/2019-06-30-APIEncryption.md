---
layout: post
title: API数据加密
date: 2019-06-30
tags: 微服务
---

使用AES和RSA混合加密

两种加密算法特点：

AES（对称加密）：
1、加密方和解密方使用同一个密钥；
2、加密解密的速度比较快，适合数据比较长时的使用；
3、密钥传输的过程不安全，且容易被破解，密钥管理也比较麻烦；

RSA（非对称加密）：
1、算法强度复杂，其安全性依赖于算法与密钥。
2、加密解密的速度远远低于对称加密算法，因此不适用于数据量较大的情况。
3、非对称加密算法有两种密钥，其中一个是公开的，所以在密钥传输上不存在安全性问题，使得其在传输加密数据的安全性上又高于对称加密算法。

AES加密快，RSA安全性高，所以将两种算法混合使用，用AES加密数据，再用RSA加密AES使用的KEY

API加密前后端交互的主要流程如下：

1、后端生成密钥对，用户登录后，获取后端的公钥，并保存在当前session
2、浏览器生成密钥对，随机生成用于AES加密的明文KEY，用AES算法加密请求参数，并用后端的公钥加密KEY，将加密后的请求参数、加密后的KEY、前端公钥传给后端
（1和2主要在前后端交换公钥，生成方式可随意，需要保证在交换之后保持不变）
3、后端使用私钥解密出明文KEY（由前端使用后端公钥加密），再用KEY解密请求参数，返回数据之前，后端再随机生成用于AES加密的明文KEY，加密结果数据，用前端公钥加密KEY，将加密后的结果数据、加密后的KEY返回给前端
4、前端得到数据后，用自己的私钥解密出明文KEY，再通过KEY解密数据

示例：
![](/images/posts/api-encryption/110.png)
<br>
![](/images/posts/api-encryption/111.png)
<br>
![](/images/posts/api-encryption/113.png)

