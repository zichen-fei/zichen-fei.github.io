---
layout: post
title: Java内存模型
date: 2019-11-15
tags: JVM
---

### **硬件的效率与一致性**

大多数的运算任务都不可能只靠处理器“计算”就能完成，处理器要与内存交互，如读取运算数据、存储运算结果等，这个I/O操作很难消除（无法仅靠寄存器来完成所有运算任务），
由于计算机的存储设备与处理器的运算速度有几个数量级的差距，所以加入一层读写速度尽可能接近处理器运算速度的高速缓存（Cache）来作为内存与处理器之间的缓冲：
将运算需要使用到的数据复制到缓存中，让运算能快速进行，当运算结束后再从缓存同步回内存之中，这样处理器就无须等待缓慢的内存读写了

处理器、高速缓存、主内存间的交互关系如下图

![](/images/posts/JMM/a1.png)

每一个CPU都有一个自己的Cache，而它们又共享同一主内存（Main Memory），所以当多个CPU的运算任务涉及到同一块主内存区域时，就会出现缓存一致性的问题，


Java虚拟机规范中定义了Java内存模型（Java Memory Model，JMM），用于屏蔽掉各种硬件和操作系统的内存访问差异，以实现让Java程序在各种平台下都能达到一致的并发效果，
JMM规范了Java虚拟机与计算机内存是如何协同工作的：规定了一个线程如何和何时可以看到由其他线程修改过后的共享变量的值，以及在必须时如何同步的访问共享变量

